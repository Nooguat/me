# Maldev for dummies
Notes taken form the Cas van Cooten slides at Hack in Paris

Maldev is a hard thing. You should inspire yourself from the many existing resources but do not **blind copy/paste as likely fingerprinted by the defensive tools**

## Theory 

- You can use any language you want; each has its drawbacks
- Take the language caracteristics in consideration : 
  - Interpreted ?
  - High level ?
  - What is my experience with it ?
  - Prevalence

### Delivery
  One of the most important thing 

  The containing file has to be linked to the pretext

  Exemples :
  - Binary files (exe)
  - DLL 
  - Office files (.xlsm, .doc)
  - Add-in  (.xll, .wll)
  - Shortcut files

  Malware can be converted to certain formats : MacroPack, Donut, sRDI

  Then; there is a ton of executions techniques : Natives functionnality; shellcode exec; DLL sideload; DLL injection...

  **All the Windows API (which is useful at any moment of the pwn) is at the MSDN**

  Actually; the Windows API and the native API are the same things; often wrapper

### Execution process 
  Allocate executable memory -> copy shellcode into memory -> make memory executable -> execute the shellcode

  **For shellcode generation; use the msfvenom**

### Shellcode injection
Definition : 

Execution of the shellcode inside another process. This is very hard to hide but the malware will have great benefits

The process must be one we have perms on -> user context process (called handle)

### Defense evasion

AV escape is relatively easy ; just get rid of bad indicators 

Ofbuscation can help getting rid of the suspicious indicators

Encryption of the shellcode (ROT/XOR) is the bare minimum

Don't go too much Ofbuscation; can be an indicator ifself
